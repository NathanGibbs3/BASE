---
language: php

# blocklist
branches:
  except:
    - documentation
    - gh-ops

services:
  - mysql
  - postgresql

php:
  - 5.2 dist: precise
  - 5.3 dist: precise
  - 5.4
  - 5.5
  - 5.6
  - 7.0
  - 7.1
  - 7.2
  - 7.3
  - nightly

# Default DB
env:
  matrix:
    - DB=mysql
    - DB=postgres

matrix:
  include:
    - php: 5.2
      dist: precise
      env: DB=postgres
    - php: 5.3
      dist: precise
      env: DB=postgres
    - php: 5.4
      env: DB=postgres
    - php: 5.5
      env: DB=postgres
    - php: 5.6
      env: DB=postgres
    - php: 7.0
      if: branch != php5only
      env: DB=postgres
    - php: 7.1
      if: branch != php5only
      env: DB=postgres
    - php: 7.2
      if: branch != php5only
      env: DB=postgres
    - php: 7.3
      if: branch != php5only
      env: DB=postgres
    - php: nightly
      if: branch != php5only
      env: DB=postgres

before_install:
  - sudo apt-get update > /dev/null

before_script:

script:
  - sh -c "if [ '$DB' = 'postgres' ]; then psql -c 'DROP DATABASE IF EXISTS snort;' -U postgres > output-pqsql.txt; fi"
  - sh -c "if [ '$DB' = 'postgres' ]; then psql -c 'CREATE DATABASE snort;' -U postgres >> output-pqsql.txt; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then mysql -e 'CREATE DATABASE IF NOT EXISTS snort;' > output-mysql.txt; fi"
  - sh -c "if [ '$DB' = 'postgress' ]; then psql -d snort -f sql/create_base_tbls_pysql.sql >> output-pqsql.txt; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then mysql snort < sql/create_base_tbls_mysql.sql >> output-mysql.txt; fi"
  - sh -c "if [ '$DB' = 'postgress' ]; then psql -d snort -f sql/create_base_tbls_pysql_extra.sql >> output-pqsql.txt; fi"
  - php -f index.php
