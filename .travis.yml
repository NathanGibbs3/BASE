---
language: php

# branch blocklist
branches:
  except:
    - documentation
    - gh-ops

# setup services
services:
  - mysql
  - postgresql

# Adds build for each of these to default matrix.

php:
  - 5.2
  - 5.3
  - 5.4
  - 5.5
  - 5.6
  - 7.0
  - 7.1
  - 7.2
  - 7.3
  - nightly

env:
  matrix:
    - DB=mysql
    - DB=postgres

# Default matrix overlay.
matrix:
  exclude:
    - dist: trusty
      php: 5.2
    - dist: trusty
      php: 5.3
  include:
    - php: 5.2
      dist: precise
    - php: 5.3
      dist: precise
    - php: 5.4
    - php: 5.5
    - php: 5.6
    - php: 7.0
      if: branch != php5only
    - php: 7.1
      if: branch != php5only
    - php: 7.2
      if: branch != php5only
    - php: 7.3
      if: branch != php5only
    - php: nightly
      if: branch != php5only

before_install:
  - sudo apt-get update > /dev/null

before_script:

script:
  - sh -c "if [ '$DB' = 'postgres' ]; then psql -c 'DROP DATABASE IF EXISTS snort;' -U postgres > output-pqsql.txt; fi"
  - sh -c "if [ '$DB' = 'postgres' ]; then psql -c 'CREATE DATABASE snort;' -U postgres >> output-pqsql.txt; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then mysql -e 'CREATE DATABASE IF NOT EXISTS snort;' > output-mysql.txt; fi"
  - sh -c "if [ '$DB' = 'postgres' ]; then psql -d snort -f sql/create_base_tbls_pgsql.sql >> output-pqsql.txt; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then mysql snort < sql/create_base_tbls_mysql.sql >> output-mysql.txt; fi"
  - sh -c "if [ '$DB' = 'postgres' ]; then psql -d snort -f sql/create_base_tbls_pgsql_extra.sql >> output-pqsql.txt; fi"
  - php -f index.php
